# Readme

Задача. Представим что у меня есть бесконечное число каналов связи.
(В данном примере их два Telegram и Slack). 
Есть таблица users, который хочет получать уведомления на определенный
chatId, используя определенный bot_token. Для каждого пользователя он разных
(В реальных задачах возникают немного другие кейсы. Например, отправлять несколько
постов в твитер и фейсбук с разных client_id и client_secret, чтобы квоты не нарушать).

В чем проблема:
1. TelegramService и SlackService при такой конфигурации не зарегистировать в контейнер
(в laravel/прочих фреймоворках с DI берут сервис и прокидывают токен)
2. Нужен аналог фабричного метода, но при этом:
-не хочется создавать сервисы через new. Т.к. это нарушает концепцию DI. 
- Прокидывать контейнер в фабрику не хочется. 
-прокидывать все зависимости в конструктор фабрики  тоже не хочется, чтобы не терять lazy_init, 
а также не загромождать конструктор(планируется много сервисов, конструктор из 10 параметров не хорошо).

Проблема была описана и частично решена здесь https://www.codeproject.com/Articles/1206764/Clean-Factory-Design-Pattern-with-IoC-Container.
В данном репозитории, я решил проблему с помощью closure.
Интересный код тут:
- App\Providers\NotificationServiceProvider
- App\Service\Sender

Если кто-то знает решение лучше, просьба об этом сообщить

TODO:
- Перевести это на php-di.
- Оптимизировать и сделать в более общем виде коллекцию из провайдера
